<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Сбор отзывов с Booking.com</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f8f9fa; padding: 40px 0; }
        .card { border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        #log {
            height: 180px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.9em;
            background: #f1f3f5;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 8px;
        }
        footer { margin-top: 60px; text-align: center; color: #6c757d; font-size: 0.9em; }
    </style>
</head>
<body>
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-10 col-lg-8">
            <div class="card p-4">
                <h2 class="text-center mb-4">Сбор отзывов с Booking.com</h2>

                <form method="post" action="/parse" onsubmit="startParsing(); return false;">
                    <div class="mb-3">
                        <label class="form-label"><strong>Ссылка на отель</strong></label>
                        <input type="text" name="url" class="form-control" placeholder="https://www.booking.com/hotel/..." required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 mb-3">Запустить парсинг</button>
                </form>

                <div id="progress-section" style="display: none;">
                    <label class="form-label"><strong>Процесс работы</strong></label>
                    <div id="log">Ожидание...</div>
                </div>
            </div>
            <footer>Booking Parser — работает в браузере</footer>
        </div>
    </div>
</div>

<script>
let eventSource = null;

function startParsing() {
    const url = document.querySelector('input[name="url"]').value.trim();
    if (!url) {
        alert("Введите ссылку");
        return;
    }

    document.getElementById('progress-section').style.display = 'block';
    const log = document.getElementById('log');
    log.innerHTML = 'Запуск...\n';

    // Отправляем запрос
    fetch('/parse', {
        method: 'POST',
        body: new FormData(document.querySelector('form'))
    }).then(() => {
        // Подключаем логи
        if (eventSource) eventSource.close();
        eventSource = new EventSource('/progress');

        eventSource.onmessage = function(e) {
            const msg = e.data;
            if (msg) {
                log.innerHTML += msg + '\n';
                log.scrollTop = log.scrollHeight;
                if (msg.includes("готов") || msg.includes("Готово")) {
                    setTimeout(() => {
                        window.location.href = '/download';
                    }, 1000);
                }
            }
        };
    });
}
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>